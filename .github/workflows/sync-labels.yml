name: Sync Labels

on:
  push:
    branches: [main, dev, pre-release/alpha/*, pre-release/beta/*, pre-release/rc/*, hotfix/*]
    paths: ['.github/labels.yml']
  workflow_dispatch:

jobs:
  sync-labels:
    runs-on: ubuntu-latest
    permissions:
      issues: write
    steps:
      - name: üì¶ Install GitHub CLI
        run: sudo apt-get update && sudo apt-get install -y gh

      - name: üîê Setup GitHub CLI authentication
        run: |
          # –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é
          echo "‚úÖ GitHub CLI installed"
          echo "üîë Using GITHUB_TOKEN for authentication"

      - name: üè∑Ô∏è Create essential labels
        run: |
          echo "üìã Syncing labels for: ${{ github.repository }}"
          echo "üîó Repository URL: https://github.com/${{ github.repository }}"
          
          # –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø –∫ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—é
          echo "üîç Testing repository access..."
          echo if gh repo view ${{ github.repository }} >/dev/null 2>&1; then
                echo "‚úÖ Repository access confirmed!"
                else
                echo "‚ùå Cannot access repository. Please check:"
                echo "   - Repository exists: https://github.com/${{ github.repository }}"
                echo "   - GITHUB_TOKEN has issues:write permissions"
                echo "   - Repository is not private or restricted"
                exit 1
              fi

          # –û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–∫–∏
          echo "üéØ Creating core labels..."
          gh label create "bug" --color "d73a4a" --description "–û—à–∏–±–∫–∏ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ –∏–ª–∏ –±–∞–≥–∏ –≤ –ø–ª–∞–≥–∏–Ω–∞—Ö" --force
          gh label create "feature" --color "a2eeef" --description "–ù–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ø–ª–∞–≥–∏–Ω–æ–≤" --force
          gh label create "refactor" --color "d4c5f9" --description "–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –∫–æ–¥–∞" --force
          gh label create "build" --color "0075ca" --description "–ó–∞–¥–∞—á–∏ —Å–±–æ—Ä–∫–∏ –∏ CI/CD" --force
          gh label create "docs" --color "0075ca" --description "–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è" --force
          gh label create "test" --color "d93f0b" --description "–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ" --force

          # –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã
          echo "üö¶ Creating priority labels..."
          gh label create "priority-critical" --color "b60205" --description "–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç - –±–ª–æ–∫–∏—Ä—É–µ—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É" --force
          gh label create "priority-high" --color "d93f0b" --description "–í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç - –≤–∞–∂–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏" --force
          gh label create "priority-medium" --color "0e8a16" --description "–°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç - –æ–±—ã—á–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞" --force
          gh label create "priority-low" --color "ededed" --description "–ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç - —É–ª—É—á—à–µ–Ω–∏—è" --force

          # –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
          echo "üîß Creating component labels..."
          gh label create "component-compiler" --color "bfdadc" --description "–°–≤—è–∑–∞–Ω–æ —Å AMXX –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä–æ–º" --force
          gh label create "component-ci-cd" --color "bfd4f2" --description "–°–≤—è–∑–∞–Ω–æ —Å CI/CD –ø–∞–π–ø–ª–∞–π–Ω–æ–º" --force
          gh label create "component-plugins" --color "d4c5f9" --description "–°–≤—è–∑–∞–Ω–æ —Å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–æ–π –ø–ª–∞–≥–∏–Ω–æ–≤" --force
          gh label create "component-docs" --color "0075ca" --description "–°–≤—è–∑–∞–Ω–æ —Å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–µ–π" --force

          echo "‚úÖ All labels created successfully!"
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: üìä Verify labels
        run: |
          echo "üìã Current labels in repository:"
          gh label list
          echo ""
          echo "‚úÖ Label synchronization completed!"
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}