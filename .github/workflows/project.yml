name: Project Automation

on:
  issues:
    types: [opened, reopened, closed]
  pull_request:
    types: [opened, reopened, closed, ready_for_review]
  workflow_dispatch:

permissions:
  contents: read
  issues: write
  pull-requests: write

jobs:
  project-automation:
    runs-on: ubuntu-latest
    steps:
      - name: ðŸš€ Checkout code (with private token)
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.PRIVATE_REPO_TOKEN }}

      - name: ðŸ“‹ Process project items
        env:
          GH_TOKEN: ${{ secrets.PRIVATE_REPO_TOKEN }}
        run: |
          echo "## ðŸ—‚ï¸ Project Automation Summary" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          
          if [ "${{ github.event_name }}" = "issues" ]; then
            echo "### ðŸ“ Issue Processing" >> $GITHUB_STEP_SUMMARY
            echo "- **Issue:** #${{ github.event.issue.number }}" >> $GITHUB_STEP_SUMMARY
            echo "- **Title:** ${{ github.event.issue.title }}" >> $GITHUB_STEP_SUMMARY
            echo "- **Action:** ${{ github.event.action }}" >> $GITHUB_STEP_SUMMARY
          else
            echo "### ðŸ”€ Pull Request Processing" >> $GITHUB_STEP_SUMMARY
            echo "- **PR:** #${{ github.event.pull_request.number }}" >> $GITHUB_STEP_SUMMARY
            echo "- **Title:** ${{ github.event.pull_request.title }}" >> $GITHUB_STEP_SUMMARY
            echo "- **Action:** ${{ github.event.action }}" >> $GITHUB_STEP_SUMMARY
          fi
          
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ðŸŽ¯ Target Project" >> $GITHUB_STEP_SUMMARY
          echo "- **Project:** NightMira/Project#3" >> $GITHUB_STEP_SUMMARY
          echo "- **Repository:** ${{ github.repository }}" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY

      - name: ðŸ“‹ Add new items to project
        if: github.event_name == 'issues' && github.event.action == 'opened' || github.event_name == 'pull_request' && github.event.action == 'opened'
        env:
          GH_TOKEN: ${{ secrets.PRIVATE_REPO_TOKEN }}
        run: |
          echo "ðŸŽ¯ Adding ${{ github.event_name }} to project..."
          
          if [ "${{ github.event_name }}" = "issues" ]; then
            ITEM_URL="https://github.com/NightMira/amxModX_MultiMod-MirGame/issues/${{ github.event.issue.number }}"
            echo "ðŸ“ Issue URL: $ITEM_URL"
          else
            ITEM_URL="https://github.com/NightMira/amxModX_MultiMod-MirGame/pull/${{ github.event.pull_request.number }}"
            echo "ðŸ“ PR URL: $ITEM_URL"
          fi
          
          # Ð”Ð¾Ð±Ð°Ð²Ð»ÑÐµÐ¼ Ð² Ð¿Ñ€Ð¾ÐµÐºÑ‚ Ð¾Ñ€Ð³Ð°Ð½Ð¸Ð·Ð°Ñ†Ð¸Ð¸ NightMira
          if gh project item-add 3 --owner NightMira --url "$ITEM_URL"; then
            echo "âœ… Added to project successfully!"
            echo "### âœ… Successfully Added to Project" >> $GITHUB_STEP_SUMMARY
            echo "Item was successfully added to the project." >> $GITHUB_STEP_SUMMARY
          else
            echo "âš ï¸ Failed to add to project."
            echo "### âš ï¸ Failed to Add to Project" >> $GITHUB_STEP_SUMMARY
            echo "There was an issue adding the item to the project." >> $GITHUB_STEP_SUMMARY
          fi

      - name: ðŸ“‹ Final summary
        run: |
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ðŸ“Š Workflow Information" >> $GITHUB_STEP_SUMMARY
          echo "- **Workflow:** ${{ github.workflow }}" >> $GITHUB_STEP_SUMMARY
          echo "- **Run ID:** ${{ github.run_id }}" >> $GITHUB_STEP_SUMMARY
          echo "- **Timestamp:** $(date '+%Y-%m-%d %H:%M:%S')" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "*Automatically processed by GitHub Actions*" >> $GITHUB_STEP_SUMMARY